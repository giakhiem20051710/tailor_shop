<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FavoriteService - T√†i Li·ªáu Chi Ti·∫øt</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        h2 {
            color: #ffd700;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        h3 {
            color: #00ff88;
            margin: 25px 0 15px;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mermaid {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            color: #00ff88;
            font-family: 'Consolas', monospace;
        }

        pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }

        pre code {
            padding: 0;
            background: transparent;
        }

        .success-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 217, 255, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00ff88;
            margin: 15px 0;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(0, 123, 255, 0.1), rgba(0, 217, 255, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
        }

        ul,
        ol {
            padding-left: 25px;
            margin: 10px 0;
        }

        li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }

        .badge-primary {
            background: #007bff;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: black;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .back-link {
            display: inline-block;
            color: #00d9ff;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 10px 20px;
            border: 1px solid #00d9ff;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(0, 217, 255, 0.2);
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #666;
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Quay l·∫°i trang ch√≠nh</a>

        <h1>‚ù§Ô∏è FavoriteService</h1>
        <p class="subtitle">H·ªá th·ªëng Y√™u Th√≠ch - Wishlist ƒëa lo·∫°i s·∫£n ph·∫©m</p>

        <!-- Overview Section -->
        <div class="section">
            <h2>üìã T·ªïng Quan</h2>
            <p>FavoriteService qu·∫£n l√Ω danh s√°ch y√™u th√≠ch c·ªßa kh√°ch h√†ng v·ªõi h·ªó tr·ª£ nhi·ªÅu lo·∫°i s·∫£n ph·∫©m:</p>
            
            <div class="success-box">
                <strong>‚ú® Key Features:</strong>
                <ul>
                    <li><strong>Generic Favorites:</strong> H·ªó tr·ª£ nhi·ªÅu lo·∫°i item (Product, Fabric, Service, Image Asset)</li>
                    <li><strong>Toggle Mode:</strong> Add/Remove v·ªõi single action</li>
                    <li><strong>Bulk Check:</strong> Ki·ªÉm tra nhi·ªÅu item c√πng l√∫c</li>
                    <li><strong>User-Specific:</strong> M·ªói user c√≥ wishlist ri√™ng</li>
                    <li><strong>Frontend Integration:</strong> Tr·∫°ng th√°i y√™u th√≠ch cho UI</li>
                </ul>
            </div>
        </div>

        <!-- Architecture Diagram -->
        <div class="section">
            <h2>üèóÔ∏è Ki·∫øn Tr√∫c T·ªïng Quan</h2>
            <div class="mermaid">
flowchart TB
    subgraph Client["üì± Client"]
        FE[Frontend App]
    end

    subgraph Controller["üéÆ Controller Layer"]
        FC[FavoriteController]
    end

    subgraph Service["‚öôÔ∏è Service Layer"]
        FS[FavoriteService]
    end

    subgraph Repository["üíæ Repository Layer"]
        FR[FavoriteRepository]
        PR[ProductRepository]
        FBR[FabricRepository]
        IAR[ImageAssetRepository]
    end

    FE --> FC
    FC --> FS
    FS --> FR
    FS --> PR
    FS --> FBR
    FS --> IAR
            </div>
        </div>

        <!-- Favorite Item Types -->
        <div class="section">
            <h2>üìå Favorite Item Types</h2>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>M√¥ t·∫£</th>
                        <th>Target Entity</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>PRODUCT</code></td>
                        <td>S·∫£n ph·∫©m may s·∫µn</td>
                        <td>ProductEntity</td>
                    </tr>
                    <tr>
                        <td><code>FABRIC</code></td>
                        <td>V·∫£i (th√≠ch m·∫´u v·∫£i)</td>
                        <td>FabricEntity</td>
                    </tr>
                    <tr>
                        <td><code>SERVICE</code></td>
                        <td>D·ªãch v·ª• may ƒëo</td>
                        <td>ServiceEntity</td>
                    </tr>
                    <tr>
                        <td><code>IMAGE_ASSET</code></td>
                        <td>M·∫´u thi·∫øt k·∫ø</td>
                        <td>ImageAssetEntity</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <strong>üí° Flexible Design:</strong>
                <p>Thi·∫øt k·∫ø generic cho ph√©p d·ªÖ d√†ng th√™m lo·∫°i item m·ªõi trong t∆∞∆°ng lai m√† kh√¥ng c·∫ßn thay ƒë·ªïi c·∫•u tr√∫c database.</p>
            </div>
        </div>

        <!-- Entity Diagram -->
        <div class="section">
            <h2>üìä Entity Diagram</h2>
            <div class="mermaid">
erDiagram
    USER ||--o{ FAVORITE : has
    FAVORITE ||--o| PRODUCT : references
    FAVORITE ||--o| FABRIC : references
    FAVORITE ||--o| SERVICE : references
    FAVORITE ||--o| IMAGE_ASSET : references

    FAVORITE {
        Long id PK
        Long user_id FK
        FavoriteItemType itemType
        Long itemId
        Timestamp createdAt
        Boolean isDeleted
    }

    USER {
        Long id PK
        String fullName
        String email
    }

    PRODUCT {
        Long id PK
        String name
        String code
    }

    FABRIC {
        Long id PK
        String name
        String color
    }
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="section">
            <h2>üåê API Endpoints</h2>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>M√¥ t·∫£</th>
                        <th>Auth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/favorites</code></td>
                        <td>Danh s√°ch y√™u th√≠ch c·ªßa user</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/favorites/{type}</code></td>
                        <td>L·ªçc theo lo·∫°i item</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td><code>/api/v1/favorites</code></td>
                        <td>Th√™m v√†o y√™u th√≠ch</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-danger">DELETE</span></td>
                        <td><code>/api/v1/favorites/{type}/{itemId}</code></td>
                        <td>X√≥a kh·ªèi y√™u th√≠ch</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-warning">PUT</span></td>
                        <td><code>/api/v1/favorites/toggle</code></td>
                        <td>Toggle y√™u th√≠ch</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/favorites/check/{type}/{itemId}</code></td>
                        <td>Ki·ªÉm tra ƒë√£ y√™u th√≠ch ch∆∞a</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td><code>/api/v1/favorites/check-batch</code></td>
                        <td>Ki·ªÉm tra nhi·ªÅu item</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/favorites/count</code></td>
                        <td>ƒê·∫øm s·ªë item y√™u th√≠ch</td>
                        <td>CUSTOMER</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Add to Favorites Flow -->
        <div class="section">
            <h2>üîÑ Add to Favorites Flow</h2>
            <div class="mermaid">
sequenceDiagram
    participant C as Customer
    participant FC as FavoriteController
    participant FS as FavoriteService
    participant FR as FavoriteRepository
    participant IR as ItemRepository

    C->>FC: POST /favorites {itemType: "PRODUCT", itemId: 123}
    FC->>FS: addFavorite(request, userId)
    
    FS->>IR: findById(itemId) [ProductRepo/FabricRepo/...]
    
    alt Item Not Found
        IR-->>FS: null
        FS-->>C: 404 Not Found
    else Item Found
        IR-->>FS: ItemEntity
        
        FS->>FR: findByUserIdAndItemTypeAndItemIdAndIsDeletedFalse(...)
        
        alt Already Favorited
            FR-->>FS: existingFavorite
            FS-->>C: 409 Conflict (Already in favorites)
        else Not Favorited
            FR-->>FS: null
            
            FS->>FS: Create FavoriteEntity
            Note over FS: userId, itemType, itemId
            Note over FS: createdAt = now()
            
            FS->>FR: save(favorite)
            FR-->>FS: savedFavorite
            
            FS-->>C: 200 OK {favoriteResponse}
        end
    end
            </div>
        </div>

        <!-- Toggle Flow -->
        <div class="section">
            <h2>üîÄ Toggle Favorite Flow</h2>
            <div class="mermaid">
sequenceDiagram
    participant C as Customer
    participant FC as FavoriteController
    participant FS as FavoriteService
    participant FR as FavoriteRepository

    C->>FC: PUT /favorites/toggle {itemType, itemId}
    FC->>FS: toggle(request, userId)
    
    FS->>FR: findByUserIdAndItemTypeAndItemIdAndIsDeletedFalse(...)
    
    alt Currently Favorited
        FR-->>FS: existingFavorite
        FS->>FS: softDelete(favorite)
        Note over FS: isDeleted = true
        FS->>FR: save(favorite)
        FS-->>C: 200 OK {isFavorite: false}
    else Not Favorited
        FR-->>FS: null
        FS->>FS: Create new favorite
        FS->>FR: save(favorite)
        FS-->>C: 200 OK {isFavorite: true}
    end
            </div>

            <div class="success-box">
                <strong>‚úÖ Toggle Benefits:</strong>
                <ul>
                    <li>Single API call cho c·∫£ add v√† remove</li>
                    <li>Frontend kh√¥ng c·∫ßn track tr·∫°ng th√°i tr∆∞·ªõc ƒë√≥</li>
                    <li>Atomic operation - kh√¥ng b·ªã race condition</li>
                </ul>
            </div>
        </div>

        <!-- Batch Check -->
        <div class="section">
            <h2>üì¶ Batch Check Flow</h2>
            <div class="mermaid">
sequenceDiagram
    participant C as Customer
    participant FC as FavoriteController
    participant FS as FavoriteService
    participant FR as FavoriteRepository

    C->>FC: POST /favorites/check-batch {items: [{type, id}, ...]}
    FC->>FS: checkBatch(request, userId)
    
    FS->>FR: findAllByUserIdAndIsDeletedFalse(userId)
    FR-->>FS: List<Favorite>
    
    FS->>FS: Build Set<"type:itemId"> from favorites
    
    loop Each requested item
        FS->>FS: Check if "type:itemId" exists in set
    end
    
    FS-->>C: 200 OK {results: [{type, itemId, isFavorite}, ...]}
            </div>

            <h3>Request Example</h3>
            <pre><code>{
    "items": [
        {"type": "PRODUCT", "itemId": 123},
        {"type": "PRODUCT", "itemId": 456},
        {"type": "FABRIC", "itemId": 789}
    ]
}</code></pre>

            <h3>Response Example</h3>
            <pre><code>{
    "results": [
        {"type": "PRODUCT", "itemId": 123, "isFavorite": true},
        {"type": "PRODUCT", "itemId": 456, "isFavorite": false},
        {"type": "FABRIC", "itemId": 789, "isFavorite": true}
    ]
}</code></pre>

            <div class="info-box">
                <strong>üöÄ Performance:</strong>
                <p>Batch check gi√∫p gi·∫£m s·ªë l∆∞·ª£ng API calls khi hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m v·ªõi tr·∫°ng th√°i y√™u th√≠ch.</p>
            </div>
        </div>

        <!-- DTOs -->
        <div class="section">
            <h2>üì¶ Data Transfer Objects</h2>

            <h3>FavoriteRequest</h3>
            <pre><code>{
    "itemType": "PRODUCT",  // PRODUCT, FABRIC, SERVICE, IMAGE_ASSET
    "itemId": 123
}</code></pre>

            <h3>FavoriteResponse</h3>
            <pre><code>{
    "id": 1,
    "itemType": "PRODUCT",
    "itemId": 123,
    "itemName": "Vest Nam Cao C·∫•p",
    "itemImage": "https://cdn.example.com/product.jpg",
    "itemPrice": 2500000,
    "createdAt": "2024-01-15T10:30:00Z"
}</code></pre>

            <h3>FavoriteListResponse</h3>
            <pre><code>{
    "items": [
        {
            "id": 1,
            "itemType": "PRODUCT",
            "itemId": 123,
            "itemName": "Vest Nam Cao C·∫•p",
            ...
        },
        {
            "id": 2,
            "itemType": "FABRIC",
            "itemId": 456,
            "itemName": "V·∫£i Wool Premium",
            ...
        }
    ],
    "total": 15,
    "page": 0,
    "size": 10
}</code></pre>
        </div>

        <!-- Frontend Integration -->
        <div class="section">
            <h2>üíª Frontend Integration</h2>
            
            <h3>Product Card Component</h3>
            <pre><code>// React component example
function ProductCard({ product }) {
    const [isFavorite, setIsFavorite] = useState(false);
    
    // Check favorite status on mount
    useEffect(() => {
        checkFavorite('PRODUCT', product.id);
    }, []);
    
    const handleToggle = async () => {
        const result = await api.put('/favorites/toggle', {
            itemType: 'PRODUCT',
            itemId: product.id
        });
        setIsFavorite(result.isFavorite);
    };
    
    return (
        &lt;div className="product-card"&gt;
            &lt;img src={product.image} /&gt;
            &lt;h3&gt;{product.name}&lt;/h3&gt;
            &lt;button onClick={handleToggle}&gt;
                {isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
            &lt;/button&gt;
        &lt;/div&gt;
    );
}</code></pre>

            <h3>Product List v·ªõi Batch Check</h3>
            <pre><code>// Load product list with favorite status
async function loadProducts() {
    const products = await api.get('/products');
    
    // Batch check favorite status
    const checks = products.map(p => ({type: 'PRODUCT', itemId: p.id}));
    const favoriteStatus = await api.post('/favorites/check-batch', {items: checks});
    
    // Merge status into products
    products.forEach((p, i) => {
        p.isFavorite = favoriteStatus.results[i].isFavorite;
    });
}</code></pre>
        </div>

        <!-- Dependencies -->
        <div class="section">
            <h2>üîó Dependencies</h2>
            <div class="mermaid">
flowchart LR
    subgraph FavoriteModule["‚ù§Ô∏è Favorite Module"]
        FS[FavoriteService]
    end

    subgraph ProductModule["üì¶ Product Module"]
        PR[ProductRepository]
    end

    subgraph FabricModule["üßµ Fabric Module"]
        FR[FabricRepository]
    end

    subgraph ImageModule["üñºÔ∏è Image Module"]
        IAR[ImageAssetRepository]
    end

    subgraph UserModule["üë§ User Module"]
        UR[UserRepository]
    end

    FS --> PR
    FS --> FR
    FS --> IAR
    FS --> UR
            </div>
        </div>

        <footer>
            <p>Tailor Shop - FavoriteService Documentation</p>
            <p style="margin-top: 10px;">Generated for Backend Team Reference</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>

</html>
