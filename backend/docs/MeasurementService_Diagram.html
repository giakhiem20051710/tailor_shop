<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeasurementService - T√†i Li·ªáu Chi Ti·∫øt</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        h2 {
            color: #ffd700;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        h3 {
            color: #00ff88;
            margin: 25px 0 15px;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mermaid {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            color: #00ff88;
            font-family: 'Consolas', monospace;
        }

        pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }

        pre code {
            padding: 0;
            background: transparent;
        }

        .success-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 217, 255, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00ff88;
            margin: 15px 0;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(0, 123, 255, 0.1), rgba(0, 217, 255, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
        }

        ul,
        ol {
            padding-left: 25px;
            margin: 10px 0;
        }

        li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }

        .badge-primary {
            background: #007bff;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: black;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .back-link {
            display: inline-block;
            color: #00d9ff;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 10px 20px;
            border: 1px solid #00d9ff;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(0, 217, 255, 0.2);
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #666;
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Quay l·∫°i trang ch√≠nh</a>

        <h1>üìè MeasurementService</h1>
        <p class="subtitle">H·ªá th·ªëng Qu·∫£n l√Ω S·ªë ƒêo - Customer Body Measurements v·ªõi Versioning</p>

        <!-- Overview Section -->
        <div class="section">
            <h2>üìã T·ªïng Quan</h2>
            <p>MeasurementService qu·∫£n l√Ω s·ªë ƒëo c∆° th·ªÉ c·ªßa kh√°ch h√†ng cho vi·ªác may ƒëo qu·∫ßn √°o:</p>
            
            <div class="success-box">
                <strong>‚ú® Key Features:</strong>
                <ul>
                    <li><strong>Body Measurements:</strong> L∆∞u tr·ªØ chi ti·∫øt c√°c s·ªë ƒëo c∆° th·ªÉ</li>
                    <li><strong>Versioning:</strong> Theo d√µi l·ªãch s·ª≠ thay ƒë·ªïi s·ªë ƒëo</li>
                    <li><strong>Customer-Linked:</strong> Li√™n k·∫øt v·ªõi t√†i kho·∫£n kh√°ch h√†ng</li>
                    <li><strong>Order Integration:</strong> S·ª≠ d·ª•ng trong ƒë∆°n h√†ng may ƒëo</li>
                    <li><strong>Staff Input:</strong> Nh√¢n vi√™n ƒëo v√† nh·∫≠p s·ªë ƒëo</li>
                </ul>
            </div>
        </div>

        <!-- Architecture Diagram -->
        <div class="section">
            <h2>üèóÔ∏è Ki·∫øn Tr√∫c T·ªïng Quan</h2>
            <div class="mermaid">
flowchart TB
    subgraph Client["üì± Client"]
        FE[Frontend App]
        POS[POS/Staff App]
    end

    subgraph Controller["üéÆ Controller Layer"]
        MC[MeasurementController]
    end

    subgraph Service["‚öôÔ∏è Service Layer"]
        MS[MeasurementService]
    end

    subgraph Repository["üíæ Repository Layer"]
        MR[MeasurementRepository]
        UR[UserRepository]
    end

    subgraph OrderModule["üìã Order Module"]
        OS[OrderService]
    end

    FE --> MC
    POS --> MC
    MC --> MS
    MS --> MR
    MS --> UR
    OS --> MS
            </div>
        </div>

        <!-- Entity Diagram -->
        <div class="section">
            <h2>üìä Entity Diagram v·ªõi Versioning</h2>
            <div class="mermaid">
erDiagram
    USER ||--o{ MEASUREMENT : has
    ORDER ||--o| MEASUREMENT : uses

    MEASUREMENT {
        Long id PK
        Long userId FK
        UUID groupId
        Integer version
        Boolean isLatest
        String type
        BigDecimal chest
        BigDecimal waist
        BigDecimal hip
        BigDecimal shoulder
        BigDecimal sleeveLength
        BigDecimal shirtLength
        BigDecimal inseam
        BigDecimal thigh
        BigDecimal neck
        BigDecimal wrist
        String notes
        Long measuredBy FK
        Timestamp createdAt
        Boolean isDeleted
    }

    USER {
        Long id PK
        String fullName
        String email
    }

    ORDER {
        Long id PK
        Long customerId FK
        Long measurementId FK
    }
            </div>

            <div class="info-box">
                <strong>üìå Versioning Logic:</strong>
                <ul>
                    <li><code>groupId</code>: UUID ƒë·ªÉ nh√≥m c√°c versions c·ªßa c√πng 1 measurement set</li>
                    <li><code>version</code>: S·ªë th·ª© t·ª± version (1, 2, 3...)</li>
                    <li><code>isLatest</code>: Flag ƒë√°nh d·∫•u version m·ªõi nh·∫•t</li>
                </ul>
            </div>
        </div>

        <!-- Measurement Fields -->
        <div class="section">
            <h2>üìê Measurement Fields</h2>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Ti·∫øng Vi·ªát</th>
                        <th>M√¥ t·∫£</th>
                        <th>ƒê∆°n v·ªã</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>chest</code></td>
                        <td>V√≤ng ng·ª±c</td>
                        <td>ƒêo ngang qua ƒëi·ªÉm l·ªìi nh·∫•t c·ªßa ng·ª±c</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>waist</code></td>
                        <td>V√≤ng eo</td>
                        <td>ƒêo ph·∫ßn h·∫πp nh·∫•t c·ªßa eo</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>hip</code></td>
                        <td>V√≤ng h√¥ng</td>
                        <td>ƒêo ph·∫ßn l·ªõn nh·∫•t c·ªßa h√¥ng</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>shoulder</code></td>
                        <td>Ngang vai</td>
                        <td>T·ª´ m·ªèm vai tr√°i ƒë·∫øn m·ªèm vai ph·∫£i</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>sleeveLength</code></td>
                        <td>D√†i tay</td>
                        <td>T·ª´ vai ƒë·∫øn c·ªï tay</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>shirtLength</code></td>
                        <td>D√†i √°o</td>
                        <td>T·ª´ c·ªï ƒë·∫øn m√¥ng (√°o s∆° mi/vest)</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>inseam</code></td>
                        <td>D√†i ƒë≈©ng qu·∫ßn</td>
                        <td>T·ª´ ƒë≈©ng ƒë·∫øn m·∫Øt c√° ch√¢n</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>thigh</code></td>
                        <td>V√≤ng ƒë√πi</td>
                        <td>Ph·∫ßn l·ªõn nh·∫•t c·ªßa ƒë√πi</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>neck</code></td>
                        <td>V√≤ng c·ªï</td>
                        <td>ƒêo quanh c·ªï</td>
                        <td>cm</td>
                    </tr>
                    <tr>
                        <td><code>wrist</code></td>
                        <td>V√≤ng c·ªï tay</td>
                        <td>ƒêo quanh c·ªï tay</td>
                        <td>cm</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- API Endpoints -->
        <div class="section">
            <h2>üåê API Endpoints</h2>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>M√¥ t·∫£</th>
                        <th>Auth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/measurements</code></td>
                        <td>Danh s√°ch measurements (admin)</td>
                        <td>ADMIN, STAFF</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/measurements/{id}</code></td>
                        <td>Chi ti·∫øt measurement</td>
                        <td>Authenticated</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/measurements/customer/{customerId}</code></td>
                        <td>Measurements c·ªßa kh√°ch h√†ng</td>
                        <td>ADMIN, STAFF</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/measurements/my</code></td>
                        <td>Measurements c·ªßa m√¨nh</td>
                        <td>CUSTOMER</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/measurements/latest/{customerId}</code></td>
                        <td>Measurement m·ªõi nh·∫•t</td>
                        <td>Authenticated</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td><code>/api/v1/measurements</code></td>
                        <td>T·∫°o measurement m·ªõi</td>
                        <td>ADMIN, STAFF</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-warning">PUT</span></td>
                        <td><code>/api/v1/measurements/{id}</code></td>
                        <td>C·∫≠p nh·∫≠t (t·∫°o version m·ªõi)</td>
                        <td>ADMIN, STAFF</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-danger">DELETE</span></td>
                        <td><code>/api/v1/measurements/{id}</code></td>
                        <td>X√≥a measurement</td>
                        <td>ADMIN</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td><code>/api/v1/measurements/history/{groupId}</code></td>
                        <td>L·ªãch s·ª≠ versions</td>
                        <td>Authenticated</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Create Measurement Flow -->
        <div class="section">
            <h2>üîÑ Create Measurement Flow</h2>
            <div class="mermaid">
sequenceDiagram
    participant S as Staff
    participant MC as MeasurementController
    participant MS as MeasurementService
    participant UR as UserRepository
    participant MR as MeasurementRepository

    S->>MC: POST /measurements {customerId, chest, waist, ...}
    MC->>MS: create(request, staffId)
    
    MS->>UR: findById(customerId)
    UR-->>MS: CustomerEntity
    
    MS->>MS: Generate new groupId (UUID)
    MS->>MS: Create MeasurementEntity
    Note over MS: groupId = new UUID
    Note over MS: version = 1
    Note over MS: isLatest = true
    Note over MS: measuredBy = staffId
    
    MS->>MR: save(measurement)
    MR-->>MS: savedMeasurement
    
    MS-->>S: 200 OK {measurementResponse}
            </div>
        </div>

        <!-- Update with Versioning -->
        <div class="section">
            <h2>üìù Update with Versioning Flow</h2>
            <div class="mermaid">
sequenceDiagram
    participant S as Staff
    participant MC as MeasurementController
    participant MS as MeasurementService
    participant MR as MeasurementRepository

    S->>MC: PUT /measurements/{id} {chest, waist, ...}
    MC->>MS: update(id, request, staffId)
    
    MS->>MR: findByIdAndIsDeletedFalse(id)
    MR-->>MS: existingMeasurement
    
    MS->>MS: Copy existingMeasurement.groupId
    MS->>MS: Mark existing.isLatest = false
    MS->>MR: save(existingMeasurement)
    
    MS->>MS: Create NEW MeasurementEntity
    Note over MS: groupId = existing.groupId
    Note over MS: version = existing.version + 1
    Note over MS: isLatest = true
    Note over MS: Copy all fields from request
    
    MS->>MR: save(newMeasurement)
    MR-->>MS: savedMeasurement
    
    MS-->>S: 200 OK {newMeasurementResponse}
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong>
                <p>Update kh√¥ng s·ª≠a ƒë·ªïi record c≈© m√† t·∫°o version m·ªõi. Record c≈© ƒë∆∞·ª£c gi·ªØ l·∫°i cho l·ªãch s·ª≠ v√† c√°c ƒë∆°n h√†ng ƒë√£ d√πng measurement ƒë√≥.</p>
            </div>
        </div>

        <!-- Version History -->
        <div class="section">
            <h2>üìö Version History</h2>
            <div class="mermaid">
flowchart TB
    subgraph GroupA["üìä GroupId: abc-123"]
        V1[Version 1<br/>2024-01-01<br/>isLatest: false]
        V2[Version 2<br/>2024-03-15<br/>isLatest: false]
        V3[Version 3<br/>2024-06-20<br/>isLatest: true]
    end

    V1 --> V2 --> V3
    
    subgraph Usage["üîó Order References"]
        O1[Order #101<br/>uses V1]
        O2[Order #205<br/>uses V2]
        O3[Order #310<br/>uses V3]
    end

    V1 -.-> O1
    V2 -.-> O2
    V3 -.-> O3
            </div>

            <h3>History Response Example</h3>
            <pre><code>{
    "groupId": "abc-123-def-456",
    "customerId": 789,
    "customerName": "Nguy·ªÖn VƒÉn A",
    "versions": [
        {
            "id": 1,
            "version": 1,
            "isLatest": false,
            "chest": 92,
            "waist": 80,
            "measuredBy": "Staff Nguy·ªÖn",
            "createdAt": "2024-01-01T10:00:00Z"
        },
        {
            "id": 2,
            "version": 2,
            "isLatest": false,
            "chest": 94,
            "waist": 82,
            "measuredBy": "Staff Tr·∫ßn",
            "createdAt": "2024-03-15T14:30:00Z"
        },
        {
            "id": 3,
            "version": 3,
            "isLatest": true,
            "chest": 93,
            "waist": 81,
            "measuredBy": "Staff L√™",
            "createdAt": "2024-06-20T09:15:00Z"
        }
    ]
}</code></pre>
        </div>

        <!-- Order Integration -->
        <div class="section">
            <h2>üìã Order Integration</h2>
            <div class="mermaid">
sequenceDiagram
    participant C as Customer
    participant OS as OrderService
    participant MS as MeasurementService
    participant OR as OrderRepository

    C->>OS: Create Custom Order
    OS->>MS: getLatestByCustomerId(customerId)
    MS-->>OS: latestMeasurement (or null)
    
    alt Has Measurement
        OS->>OS: Attach measurementId to order
        OS->>OR: save(order)
        OR-->>OS: savedOrder
    else No Measurement
        OS-->>C: 400 Bad Request (Need measurement first)
    end
            </div>

            <div class="info-box">
                <strong>üí° Workflow:</strong>
                <ol>
                    <li>Kh√°ch h√†ng ƒë·∫∑t l·ªãch h·∫πn ƒëo</li>
                    <li>Staff ƒëo v√† nh·∫≠p s·ªë ƒëo v√†o h·ªá th·ªëng</li>
                    <li>Khi t·∫°o ƒë∆°n h√†ng, h·ªá th·ªëng t·ª± ƒë·ªông l·∫•y s·ªë ƒëo m·ªõi nh·∫•t</li>
                    <li>ƒê∆°n h√†ng l∆∞u reference ƒë·∫øn measurement version c·ª• th·ªÉ</li>
                </ol>
            </div>
        </div>

        <!-- DTOs -->
        <div class="section">
            <h2>üì¶ Data Transfer Objects</h2>

            <h3>MeasurementRequest</h3>
            <pre><code>{
    "customerId": 123,
    "type": "FULL_BODY",  // UPPER_BODY, LOWER_BODY, FULL_BODY
    "chest": 92.5,
    "waist": 80.0,
    "hip": 95.0,
    "shoulder": 45.0,
    "sleeveLength": 60.0,
    "shirtLength": 72.0,
    "inseam": 78.0,
    "thigh": 55.0,
    "neck": 38.5,
    "wrist": 17.0,
    "notes": "Kh√°ch th√≠ch may r·ªông h∆°n 1-2cm"
}</code></pre>

            <h3>MeasurementResponse</h3>
            <pre><code>{
    "id": 1,
    "groupId": "abc-123-def-456",
    "version": 3,
    "isLatest": true,
    "customerId": 123,
    "customerName": "Nguy·ªÖn VƒÉn A",
    "type": "FULL_BODY",
    "chest": 92.5,
    "waist": 80.0,
    "hip": 95.0,
    "shoulder": 45.0,
    "sleeveLength": 60.0,
    "shirtLength": 72.0,
    "inseam": 78.0,
    "thigh": 55.0,
    "neck": 38.5,
    "wrist": 17.0,
    "notes": "Kh√°ch th√≠ch may r·ªông h∆°n 1-2cm",
    "measuredBy": {
        "id": 456,
        "name": "Staff Nguy·ªÖn"
    },
    "createdAt": "2024-06-20T09:15:00Z",
    "updatedAt": "2024-06-20T09:15:00Z"
}</code></pre>
        </div>

        <!-- Measurement Types -->
        <div class="section">
            <h2>üìê Measurement Types</h2>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>M√¥ t·∫£</th>
                        <th>Required Fields</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>UPPER_BODY</code></td>
                        <td>ƒêo ph·∫ßn tr√™n (√°o)</td>
                        <td>chest, shoulder, sleeveLength, shirtLength, neck, wrist</td>
                    </tr>
                    <tr>
                        <td><code>LOWER_BODY</code></td>
                        <td>ƒêo ph·∫ßn d∆∞·ªõi (qu·∫ßn)</td>
                        <td>waist, hip, inseam, thigh</td>
                    </tr>
                    <tr>
                        <td><code>FULL_BODY</code></td>
                        <td>ƒêo to√†n th√¢n</td>
                        <td>T·∫•t c·∫£ c√°c tr∆∞·ªùng</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Dependencies -->
        <div class="section">
            <h2>üîó Dependencies</h2>
            <div class="mermaid">
flowchart LR
    subgraph MeasurementModule["üìè Measurement Module"]
        MS[MeasurementService]
    end

    subgraph UserModule["üë§ User Module"]
        UR[UserRepository]
    end

    subgraph OrderModule["üìã Order Module"]
        OS[OrderService]
    end

    subgraph AppointmentModule["üìÖ Appointment Module"]
        AS[AppointmentService]
    end

    MS --> UR
    OS --> MS
    AS -.-> MS
            </div>
        </div>

        <footer>
            <p>Tailor Shop - MeasurementService Documentation</p>
            <p style="margin-top: 10px;">Generated for Backend Team Reference</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>

</html>
