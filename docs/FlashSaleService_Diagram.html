<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashSaleService - T√†i Li·ªáu Chi Ti·∫øt</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #ff6b9d;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        h2 {
            color: #ffd700;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        h3 {
            color: #00ff88;
            margin: 25px 0 15px;
        }

        h4 {
            color: #00d9ff;
            margin: 20px 0 10px;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mermaid {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background: rgba(255, 107, 157, 0.2);
            color: #ff6b9d;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            color: #00ff88;
            font-family: 'Consolas', monospace;
        }

        pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }

        pre code {
            padding: 0;
            background: transparent;
        }

        .critical-box {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 107, 107, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff0000;
            margin: 15px 0;
        }

        .success-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 217, 255, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00ff88;
            margin: 15px 0;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(0, 123, 255, 0.1), rgba(0, 217, 255, 0.1));
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
        }

        .algo-box {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.2), rgba(255, 215, 0, 0.1));
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff6b9d;
            margin: 15px 0;
        }

        ul,
        ol {
            padding-left: 25px;
            margin: 10px 0;
        }

        li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }

        .badge-scheduled {
            background: #6c757d;
            color: white;
        }

        .badge-active {
            background: #28a745;
            color: white;
        }

        .badge-ended {
            background: #dc3545;
            color: white;
        }

        .badge-cancelled {
            background: #343a40;
            color: white;
        }

        .badge-soldout {
            background: #fd7e14;
            color: white;
        }

        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b9d;
        }

        .stat-label {
            color: #888;
            margin-top: 5px;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #ff6b9d;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }

        .timeline-item {
            display: flex;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .config-value {
            color: #ffd700;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>‚ö° FlashSaleService - T√†i Li·ªáu Chi Ti·∫øt</h1>
        <p class="subtitle">Module Flash Sale v·ªõi Pessimistic Locking - High Concurrency System</p>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value">609</div>
                <div class="stat-label">D√≤ng code</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">16</div>
                <div class="stat-label">Methods</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">3</div>
                <div class="stat-label">Scheduled Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">SERIALIZABLE</div>
                <div class="stat-label">Isolation Level</div>
            </div>
        </div>

        <div class="critical-box">
            <strong>üî• CRITICAL: </strong>ƒê√¢y l√† service c√≥ t√≠nh ƒë·ªìng th·ªùi cao (High Concurrency), s·ª≠ d·ª•ng
            <strong>Pessimistic Locking</strong> v√† <strong>Serializable Isolation</strong> ƒë·ªÉ tr√°nh race condition
            khi nhi·ªÅu ng∆∞·ªùi mua c√πng l√∫c.
        </div>

        <!-- 1. Overview -->
        <div class="section">
            <h2>1. T·ªïng Quan H·ªá Th·ªëng</h2>

            <p><code>FlashSaleServiceImpl</code> qu·∫£n l√Ω ch∆∞∆°ng tr√¨nh flash sale v·ªõi c√°c t√≠nh nƒÉng:</p>

            <div class="success-box">
                <strong>‚úÖ Core Features:</strong>
                <ul>
                    <li><strong>Purchase Algorithm</strong> - Thu·∫≠t to√°n mua h√†ng v·ªõi lock</li>
                    <li><strong>Reservation System</strong> - Gi·ªØ h√†ng trong th·ªùi gian gi·ªõi h·∫°n</li>
                    <li><strong>User Limit</strong> - Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng m·ªói user</li>
                    <li><strong>Stock Management</strong> - Qu·∫£n l√Ω t·ªìn kho real-time</li>
                    <li><strong>Scheduled Tasks</strong> - T·ª± ƒë·ªông c·∫≠p nh·∫≠t tr·∫°ng th√°i</li>
                </ul>
            </div>

            <h3>Configuration Constants</h3>
            <table>
                <tr>
                    <th>Constant</th>
                    <th>Value</th>
                    <th>M√¥ t·∫£</th>
                </tr>
                <tr>
                    <td><code>RESERVATION_MINUTES</code></td>
                    <td class="config-value">10 ph√∫t</td>
                    <td>Th·ªùi gian gi·ªØ h√†ng sau khi ƒë·∫∑t</td>
                </tr>
                <tr>
                    <td><code>PAYMENT_DEADLINE_MINUTES</code></td>
                    <td class="config-value">10 ph√∫t</td>
                    <td>Deadline thanh to√°n</td>
                </tr>
            </table>
        </div>

        <!-- 2. Architecture -->
        <div class="section">
            <h2>2. Ki·∫øn Tr√∫c H·ªá Th·ªëng</h2>

            <div class="mermaid">
                graph TB
                subgraph "Public APIs"
                A1[getActiveSales]
                A2[getUpcomingSales]
                A3[getFeaturedSales]
                A4[getDetail]
                end

                subgraph "Admin APIs"
                B1[listAll]
                B2[create]
                B3[update]
                B4[cancel]
                end

                subgraph "Customer APIs"
                C1[purchase ‚ö° CORE]
                C2[getMyOrders]
                C3[getOrderDetail]
                C4[cancelOrder]
                C5[confirmPayment]
                end

                subgraph "Scheduled Tasks"
                D1[updateFlashSaleStatuses]
                D2[releaseExpiredReservations]
                D3[expirePendingOrders]
                end

                subgraph "Repositories"
                R1[FlashSaleRepository]
                R2[FlashSaleOrderRepository]
                R3[FlashSaleReservationRepository]
                R4[FabricRepository]
                R5[UserRepository]
                end

                C1 -->|"FOR UPDATE"| R1
                C1 --> R2
                C1 --> R3
                D1 -->|"Every 1 min"| R1
                D2 -->|"Every 30 sec"| R3
                D3 -->|"Every 1 min"| R2
            </div>
        </div>

        <!-- 3. Flash Sale Status -->
        <div class="section">
            <h2>3. Flash Sale Status Flow</h2>

            <div class="mermaid">
                stateDiagram-v2
                [*] --> SCHEDULED : Admin t·∫°o m·ªõi

                SCHEDULED --> ACTIVE : startTime ƒë·∫øn
                SCHEDULED --> CANCELLED : Admin h·ªßy

                ACTIVE --> ENDED : endTime ƒë·∫øn
                ACTIVE --> SOLD_OUT : H·∫øt h√†ng
                ACTIVE --> CANCELLED : Admin h·ªßy

                ENDED --> [*]
                SOLD_OUT --> [*]
                CANCELLED --> [*]
            </div>

            <h3>Status Badges</h3>
            <p>
                <span class="badge badge-scheduled">SCHEDULED</span> - ƒê√£ l√™n l·ªãch, ch∆∞a b·∫Øt ƒë·∫ßu<br>
                <span class="badge badge-active">ACTIVE</span> - ƒêang di·ªÖn ra<br>
                <span class="badge badge-ended">ENDED</span> - ƒê√£ k·∫øt th√∫c<br>
                <span class="badge badge-soldout">SOLD_OUT</span> - H·∫øt h√†ng<br>
                <span class="badge badge-cancelled">CANCELLED</span> - ƒê√£ h·ªßy
            </p>
        </div>

        <!-- 4. CORE: Purchase Algorithm -->
        <div class="section">
            <h2>4. ‚ö° PURCHASE ALGORITHM (Core Feature)</h2>

            <div class="algo-box">
                <h3>üîí Pessimistic Locking Strategy</h3>
                <p>S·ª≠ d·ª•ng <code>@Transactional(isolation = Isolation.SERIALIZABLE)</code> v√†
                    <code>findByIdForUpdate()</code> ƒë·ªÉ ƒë·∫£m b·∫£o ch·ªâ m·ªôt transaction c√≥ th·ªÉ modify flash sale t·∫°i m·ªôt
                    th·ªùi ƒëi·ªÉm.
                </p>
            </div>

            <h3>Purchase Flow - 9 B∆∞·ªõc</h3>

            <div class="mermaid">
                sequenceDiagram
                participant U as User
                participant S as FlashSaleService
                participant FSR as FlashSaleRepo
                participant RR as ReservationRepo
                participant OR as OrderRepo
                participant DB as Database

                U->>S: purchase(flashSaleId, request, userId)

                Note over S,DB: üîí STEP 1: LOCK FlashSale
                S->>FSR: findByIdForUpdate(id)
                FSR->>DB: SELECT ... FOR UPDATE
                Note over DB: Row locked!
                DB-->>FSR: FlashSale entity

                Note over S: STEP 2: Validate Status
                S->>S: Check CANCELLED/ENDED/SOLD_OUT
                S->>S: Check startTime/endTime

                Note over S: STEP 3: Validate Min Purchase
                S->>S: quantity >= minPurchase?

                Note over S: STEP 4: Check Stock
                S->>S: availableQuantity >= quantity?

                Note over S: STEP 5: Check User Limit
                S->>OR: sumQuantityByUserAndFlashSale()
                OR-->>S: userPurchased
                S->>S: userRemaining >= quantity?

                Note over S: STEP 6: Create Reservation
                S->>RR: save(reservation)
                Note over S: expiresAt = now + 10 min

                Note over S: STEP 7: Update Reserved Qty
                S->>S: reservedQuantity += quantity
                S->>FSR: save(flashSale)

                Note over S: STEP 8: Create Order
                S->>OR: save(order)
                Note over S: paymentDeadline = now + 10 min

                Note over S: STEP 9: Build Result
                S-->>U: FlashSalePurchaseResult
                Note over DB: üîì Lock released
            </div>

            <h3>Chi Ti·∫øt T·ª´ng B∆∞·ªõc</h3>

            <div class="timeline-item">
                <span class="step-number">1</span>
                <div>
                    <strong>LOCK Flash Sale (Critical!)</strong><br>
                    <code>flashSaleRepository.findByIdForUpdate(flashSaleId)</code><br>
                    S·ª≠ d·ª•ng <code>SELECT ... FOR UPDATE</code> ƒë·ªÉ lock row, ngƒÉn race condition.
                </div>
            </div>

            <div class="timeline-item">
                <span class="step-number">2</span>
                <div>
                    <strong>Validate Status</strong><br>
                    Ki·ªÉm tra: CANCELLED? ENDED? SOLD_OUT? Ch∆∞a b·∫Øt ƒë·∫ßu? ƒê√£ h·∫øt gi·ªù?
                </div>
            </div>

            <div class="timeline-item">
                <span class="step-number">3</span>
                <div>
                    <strong>Validate Min Purchase</strong><br>
                    <code>quantity >= sale.getMinPurchase()</code><br>
                    Th∆∞·ªùng min = 0.5 m√©t
                </div>
            </div>

            <div class="timeline-item">
                <span class="step-number">4</span>
                <div>
                    <strong>Check Available Stock</strong><br>
                    <code>availableQuantity = totalQuantity - soldQuantity - reservedQuantity</code><br>
                    N·∫øu kh√¥ng ƒë·ªß ‚Üí Return OUT_OF_STOCK
                </div>
            </div>

            <div class="timeline-item">
                <span class="step-number">5</span>
                <div>
                    <strong>Check User Limit</strong><br>
                    T·ªïng s·ªë l∆∞·ª£ng user ƒë√£ mua + quantity hi·ªán t·∫°i <= maxPerUser </div>
                </div>

                <div class="timeline-item">
                    <span class="step-number">6</span>
                    <div>
                        <strong>Create Reservation</strong><br>
                        Gi·ªØ h√†ng trong 10 ph√∫t, status = ACTIVE
                    </div>
                </div>

                <div class="timeline-item">
                    <span class="step-number">7</span>
                    <div>
                        <strong>Update Reserved Quantity</strong><br>
                        <code>sale.reservedQuantity += quantity</code>
                    </div>
                </div>

                <div class="timeline-item">
                    <span class="step-number">8</span>
                    <div>
                        <strong>Create Order</strong><br>
                        Status = PENDING, payment deadline = 10 ph√∫t
                    </div>
                </div>

                <div class="timeline-item">
                    <span class="step-number">9</span>
                    <div>
                        <strong>Build Success Result</strong><br>
                        Return orderId, orderCode, totalAmount, paymentDeadline, etc.
                    </div>
                </div>

                <h3>Purchase Result Types</h3>
                <table>
                    <tr>
                        <th>Result</th>
                        <th>Condition</th>
                        <th>Message</th>
                    </tr>
                    <tr>
                        <td class="config-value">SUCCESS</td>
                        <td>T·∫•t c·∫£ validation pass</td>
                        <td>"ƒê·∫∑t h√†ng th√†nh c√¥ng! Thanh to√°n trong 10 ph√∫t"</td>
                    </tr>
                    <tr>
                        <td>NOT_ACTIVE</td>
                        <td>Flash sale ch∆∞a active</td>
                        <td>"Flash sale ch∆∞a b·∫Øt ƒë·∫ßu" / "ƒë√£ k·∫øt th√∫c"</td>
                    </tr>
                    <tr>
                        <td>MIN_QUANTITY</td>
                        <td>quantity < minPurchase</td>
                        <td>"S·ªë l∆∞·ª£ng t·ªëi thi·ªÉu l√† X m√©t"</td>
                    </tr>
                    <tr>
                        <td>OUT_OF_STOCK</td>
                        <td>Kh√¥ng ƒë·ªß h√†ng</td>
                        <td>"H·∫øt h√†ng"</td>
                    </tr>
                    <tr>
                        <td>LIMIT_EXCEEDED</td>
                        <td>V∆∞·ª£t qu√° limit user</td>
                        <td>"B·∫°n ch·ªâ c√≥ th·ªÉ mua th√™m X m√©t"</td>
                    </tr>
                </table>
            </div>

            <!-- 5. Order Status Flow -->
            <div class="section">
                <h2>5. Flash Sale Order Status</h2>

                <div class="mermaid">
                    stateDiagram-v2
                    [*] --> PENDING : Purchase th√†nh c√¥ng

                    PENDING --> PAID : confirmPayment()
                    PENDING --> CANCELLED : cancelOrder()
                    PENDING --> EXPIRED : Qu√° deadline

                    PAID --> [*] : Ho√†n th√†nh
                    CANCELLED --> [*]
                    EXPIRED --> [*]
                </div>

                <h3>Khi Confirm Payment</h3>
                <ol>
                    <li>Reservation status ‚Üí CONVERTED</li>
                    <li>Sale.reservedQuantity -= quantity</li>
                    <li>Sale.soldQuantity += quantity</li>
                    <li>Check if SOLD_OUT</li>
                    <li>Order.status ‚Üí PAID</li>
                </ol>
            </div>

            <!-- 6. Reservation System -->
            <div class="section">
                <h2>6. Reservation System</h2>

                <div class="mermaid">
                    flowchart LR
                    subgraph "Reservation Lifecycle"
                    A[ACTIVE] -->|"User thanh to√°n"| B[CONVERTED]
                    A -->|"H·∫øt 10 ph√∫t"| C[EXPIRED]
                    A -->|"User h·ªßy"| D[CANCELLED]
                    end

                    subgraph "Stock Impact"
                    B -->|"soldQuantity +="| E[Sold]
                    C -->|"reservedQuantity -="| F[Released]
                    D -->|"reservedQuantity -="| F
                    end
                </div>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Quan tr·ªçng:</strong> Khi reservation EXPIRED ho·∫∑c CANCELLED, stock ƒë∆∞·ª£c release l·∫°i
                    ƒë·ªÉ ng∆∞·ªùi kh√°c c√≥ th·ªÉ mua.
                </div>
            </div>

            <!-- 7. Scheduled Tasks -->
            <div class="section">
                <h2>7. Scheduled Tasks (Background Jobs)</h2>

                <table>
                    <tr>
                        <th>Task</th>
                        <th>Interval</th>
                        <th>Ch·ª©c nƒÉng</th>
                    </tr>
                    <tr>
                        <td><code>updateFlashSaleStatuses()</code></td>
                        <td class="config-value">60 gi√¢y</td>
                        <td>
                            <ul>
                                <li>SCHEDULED ‚Üí ACTIVE khi ƒë·∫øn startTime</li>
                                <li>ACTIVE ‚Üí ENDED khi qua endTime</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td><code>releaseExpiredReservations()</code></td>
                        <td class="config-value">30 gi√¢y</td>
                        <td>
                            <ul>
                                <li>T√¨m reservations qu√° h·∫°n</li>
                                <li>Release stock (reservedQuantity -=)</li>
                                <li>Mark reservation EXPIRED</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td><code>expirePendingOrders()</code></td>
                        <td class="config-value">60 gi√¢y</td>
                        <td>
                            <ul>
                                <li>T√¨m orders PENDING qu√° paymentDeadline</li>
                                <li>Mark order EXPIRED</li>
                            </ul>
                        </td>
                    </tr>
                </table>

                <div class="mermaid">
                    gantt
                    title Scheduled Tasks Timeline
                    dateFormat mm:ss
                    section updateFlashSaleStatuses
                    Run :a1, 00:00, 1s
                    Wait :00:01, 59s
                    Run :a2, 01:00, 1s
                    section releaseExpiredReservations
                    Run :b1, 00:00, 1s
                    Wait :00:01, 29s
                    Run :b2, 00:30, 1s
                    Wait :00:31, 29s
                    Run :b3, 01:00, 1s
                    section expirePendingOrders
                    Run :c1, 00:00, 1s
                    Wait :00:01, 59s
                    Run :c2, 01:00, 1s
                </div>
            </div>

            <!-- 8. Entity Relationships -->
            <div class="section">
                <h2>8. Entity Relationships</h2>

                <div class="mermaid">
                    erDiagram
                    FlashSaleEntity ||--o{ FlashSaleOrderEntity : "has many"
                    FlashSaleEntity ||--o{ FlashSaleReservationEntity : "has many"
                    FlashSaleEntity }o--|| FabricEntity : "references"
                    FlashSaleEntity }o--|| UserEntity : "createdBy"

                    FlashSaleOrderEntity }o--|| UserEntity : "buyer"
                    FlashSaleOrderEntity ||--o| FlashSaleReservationEntity : "has one"

                    FlashSaleReservationEntity }o--|| UserEntity : "user"

                    FlashSaleEntity {
                    Long id PK
                    Long fabricId FK
                    String name
                    BigDecimal originalPrice
                    BigDecimal flashPrice
                    BigDecimal totalQuantity
                    BigDecimal soldQuantity
                    BigDecimal reservedQuantity
                    BigDecimal maxPerUser
                    BigDecimal minPurchase
                    OffsetDateTime startTime
                    OffsetDateTime endTime
                    FlashSaleStatus status
                    Boolean isFeatured
                    }

                    FlashSaleOrderEntity {
                    Long id PK
                    Long flashSaleId FK
                    Long userId FK
                    String orderCode UK
                    BigDecimal quantity
                    BigDecimal unitPrice
                    BigDecimal totalAmount
                    FlashSaleOrderStatus status
                    OffsetDateTime paymentDeadline
                    String paymentMethod
                    OffsetDateTime paidAt
                    }

                    FlashSaleReservationEntity {
                    Long id PK
                    Long flashSaleId FK
                    Long userId FK
                    BigDecimal quantity
                    FlashSaleReservationStatus status
                    OffsetDateTime expiresAt
                    OffsetDateTime convertedAt
                    }
                </div>
            </div>

            <!-- 9. Stock Calculation -->
            <div class="section">
                <h2>9. Stock Calculation Formula</h2>

                <pre><code>availableQuantity = totalQuantity - soldQuantity - reservedQuantity

soldPercentage = (soldQuantity / totalQuantity) * 100

discountPercent = ((originalPrice - flashPrice) / originalPrice) * 100</code></pre>

                <div class="info-box">
                    <strong>V√≠ d·ª•:</strong><br>
                    totalQuantity = 100m, soldQuantity = 30m, reservedQuantity = 10m<br>
                    ‚Üí availableQuantity = 100 - 30 - 10 = <strong>60m</strong><br>
                    ‚Üí soldPercentage = (30/100) * 100 = <strong>30%</strong>
                </div>
            </div>

            <!-- 10. Error Handling -->
            <div class="section">
                <h2>10. Error Handling</h2>

                <table>
                    <tr>
                        <th>Scenario</th>
                        <th>Exception</th>
                    </tr>
                    <tr>
                        <td>Flash sale kh√¥ng t·ªìn t·∫°i</td>
                        <td><code>NotFoundException("Flash sale kh√¥ng t·ªìn t·∫°i")</code></td>
                    </tr>
                    <tr>
                        <td>V·∫£i kh√¥ng t·ªìn t·∫°i</td>
                        <td><code>NotFoundException("V·∫£i kh√¥ng t·ªìn t·∫°i")</code></td>
                    </tr>
                    <tr>
                        <td>User kh√¥ng t·ªìn t·∫°i</td>
                        <td><code>NotFoundException("Ng∆∞·ªùi d√πng kh√¥ng t·ªìn t·∫°i")</code></td>
                    </tr>
                    <tr>
                        <td>endTime tr∆∞·ªõc startTime</td>
                        <td><code>BadRequestException("Th·ªùi gian k·∫øt th√∫c ph·∫£i sau th·ªùi gian b·∫Øt ƒë·∫ßu")</code></td>
                    </tr>
                    <tr>
                        <td>Flash price >= original price</td>
                        <td><code>BadRequestException("Gi√° flash sale ph·∫£i th·∫•p h∆°n gi√° g·ªëc")</code></td>
                    </tr>
                    <tr>
                        <td>Update flash sale ƒë√£ k·∫øt th√∫c</td>
                        <td><code>BadRequestException("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t flash sale ƒë√£ k·∫øt th√∫c")</code></td>
                    </tr>
                    <tr>
                        <td>totalQuantity < soldQuantity</td>
                        <td><code>BadRequestException("S·ªë l∆∞·ª£ng m·ªõi kh√¥ng th·ªÉ nh·ªè h∆°n s·ªë ƒë√£ b√°n")</code></td>
                    </tr>
                    <tr>
                        <td>H·ªßy order kh√¥ng ph·∫£i PENDING</td>
                        <td><code>BadRequestException("Ch·ªâ c√≥ th·ªÉ h·ªßy ƒë∆°n h√†ng ƒëang ch·ªù thanh to√°n")</code></td>
                    </tr>
                    <tr>
                        <td>Thanh to√°n qu√° h·∫°n</td>
                        <td><code>BadRequestException("ƒê∆°n h√†ng ƒë√£ h·∫øt th·ªùi gian thanh to√°n")</code></td>
                    </tr>
                </table>
            </div>

            <!-- 11. Logging -->
            <div class="section">
                <h2>11. Logging</h2>

                <ul>
                    <li>‚úÖ <code>Created flash sale: id={}, name={}</code></li>
                    <li>‚úÖ <code>Updated flash sale: id={}</code></li>
                    <li>‚úÖ <code>Cancelled flash sale: id={}</code></li>
                    <li>‚úÖ <code>Purchase attempt: flashSaleId={}, userId={}, quantity={}</code></li>
                    <li>‚úÖ <code>Purchase successful: orderId={}, orderCode={}, quantity={}</code></li>
                    <li>‚úÖ <code>Order cancelled: orderId={}</code></li>
                    <li>‚úÖ <code>Payment confirmed: orderId={}, method={}</code></li>
                    <li>‚úÖ <code>Flash sale activated: id={}</code></li>
                    <li>‚úÖ <code>Flash sale ended: id={}</code></li>
                    <li>‚úÖ <code>Reservation expired: id={}, quantity={}</code></li>
                    <li>‚úÖ <code>Expired {} pending orders</code></li>
                </ul>
            </div>

            <!-- Footer -->
            <div class="section" style="text-align: center; margin-top: 40px;">
                <p style="color: #888;">Generated by Antigravity AI Assistant</p>
                <p style="color: #666; font-size: 12px;">Last updated: 2024</p>
            </div>
        </div>

        <script>
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default',
                securityLevel: 'loose'
            });
        </script>
</body>

</html>