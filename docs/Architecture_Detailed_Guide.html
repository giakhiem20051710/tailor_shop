<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H∆∞·ªõng d·∫´n Chi ti·∫øt: N-Layer vs Clean vs DDD</title>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #48bb78;
            --accent: #ed8936;
            --nlayer: #e53e3e;
            --clean: #38a169;
            --ddd: #3182ce;
            --bg-dark: #1a202c;
            --bg-card: #2d3748;
            --text: #e2e8f0;
            --text-muted: #a0aec0;
            --border: #4a5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.8;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            padding: 3rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
        }

        .section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .section h2 {
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section h3 {
            color: var(--secondary);
            font-size: 1.2rem;
            margin: 1.5rem 0 1rem;
        }

        .section p {
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .highlight-box {
            background: #1e2433;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary);
        }

        .highlight-box.red {
            border-left-color: var(--nlayer);
        }

        .highlight-box.green {
            border-left-color: var(--clean);
        }

        .highlight-box.blue {
            border-left-color: var(--ddd);
        }

        .highlight-box h4 {
            margin-bottom: 0.5rem;
        }

        .diagram-box {
            background: #1e2433;
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        .layer-stack {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .layer {
            padding: 1rem;
            text-align: center;
            border-radius: 8px;
            font-weight: 600;
            position: relative;
        }

        .layer::after {
            content: '‚Üì';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-muted);
        }

        .layer:last-child::after {
            display: none;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding: 1rem;
        }

        .flow-box {
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            text-align: center;
            min-width: 100px;
            font-size: 0.9rem;
        }

        .flow-arrow {
            color: var(--accent);
            font-size: 1.5rem;
        }

        .code-block {
            background: #0d1117;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            border: 1px solid #30363d;
        }

        .code-block .comment {
            color: #8b949e;
        }

        .code-block .keyword {
            color: #ff7b72;
        }

        .code-block .type {
            color: #79c0ff;
        }

        .code-block .string {
            color: #a5d6ff;
        }

        .code-block .annotation {
            color: #ffa657;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .comparison-table th {
            background: var(--bg-dark);
        }

        .step-list {
            counter-reset: step;
            list-style: none;
            padding: 0;
        }

        .step-list li {
            position: relative;
            padding-left: 3rem;
            margin-bottom: 1.5rem;
        }

        .step-list li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 2rem;
            height: 2rem;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid;
        }

        .card.red {
            border-color: var(--nlayer);
        }

        .card.green {
            border-color: var(--clean);
        }

        .card.blue {
            border-color: var(--ddd);
        }

        .card h4 {
            margin-bottom: 1rem;
        }

        .card ul {
            padding-left: 1.2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .card li {
            margin: 0.5rem 0;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }
    </style>
</head>

<body>
    <div class="container">

        <header class="header">
            <h1>üèóÔ∏è H∆∞·ªõng d·∫´n Ki·∫øn tr√∫c Ph·∫ßn m·ªÅm</h1>
            <p>N-Layer vs Clean Architecture vs DDD - Gi·∫£i th√≠ch chi ti·∫øt t·ª´ c∆° b·∫£n</p>
        </header>

        <!-- PH·∫¶N 1: KH√ÅI NI·ªÜM C∆† B·∫¢N -->
        <section class="section">
            <h2>üìö Ph·∫ßn 1: T·∫°i sao c·∫ßn Ki·∫øn tr√∫c?</h2>

            <p>Ki·∫øn tr√∫c ph·∫ßn m·ªÅm gi√∫p:</p>
            <ul class="step-list">
                <li><strong>T·ªï ch·ª©c code:</strong> Bi·∫øt ƒë·∫∑t file ·ªü ƒë√¢u, class n√†o thu·ªôc module n√†o</li>
                <li><strong>D·ªÖ b·∫£o tr√¨:</strong> Thay ƒë·ªïi 1 ph·∫ßn kh√¥ng ·∫£nh h∆∞·ªüng ph·∫ßn kh√°c</li>
                <li><strong>D·ªÖ test:</strong> C√≥ th·ªÉ test t·ª´ng ph·∫ßn ri√™ng bi·ªát</li>
                <li><strong>D·ªÖ m·ªü r·ªông:</strong> Th√™m t√≠nh nƒÉng m·ªõi kh√¥ng ph√° v·ª° code c≈©</li>
            </ul>

            <div class="highlight-box">
                <h4>üí° C√¢u h·ªèi quan tr·ªçng nh·∫•t</h4>
                <p>Khi b·∫°n c·∫ßn thay ƒë·ªïi database t·ª´ MySQL sang MongoDB, b·∫°n ph·∫£i s·ª≠a bao nhi√™u file?</p>
                <p><strong>N-Layer:</strong> S·ª≠a r·∫•t nhi·ªÅu file (coupling cao)</p>
                <p><strong>Clean/DDD:</strong> Ch·ªâ s·ª≠a 1-2 file Infrastructure (coupling th·∫•p)</p>
            </div>
        </section>

        <!-- PH·∫¶N 2: N-LAYER -->
        <section class="section">
            <h2 style="color: var(--nlayer);">üì¶ Ph·∫ßn 2: N-Layer Architecture</h2>

            <h3>2.1 √ù t∆∞·ªüng ch√≠nh</h3>
            <p><strong>Chia theo t·∫ßng K·ª∏ THU·∫¨T</strong> - M·ªói t·∫ßng l√†m m·ªôt nhi·ªám v·ª• k·ªπ thu·∫≠t ri√™ng, g·ªçi xu·ªëng t·∫ßng b√™n
                d∆∞·ªõi.</p>

            <div class="diagram-box">
                <div class="layer-stack">
                    <div class="layer" style="background: linear-gradient(135deg, #63b3ed, #4299e1);">üåê Presentation
                        Layer<br><small>Controllers, API endpoints</small></div>
                    <div class="layer" style="background: linear-gradient(135deg, #667eea, #5a67d8);">‚öôÔ∏è Business Logic
                        Layer<br><small>Services - x·ª≠ l√Ω nghi·ªáp v·ª•</small></div>
                    <div class="layer" style="background: linear-gradient(135deg, #ed8936, #dd6b20);">üóÑÔ∏è Data Access
                        Layer<br><small>Repositories - ƒë·ªçc/ghi DB</small></div>
                    <div class="layer" style="background: linear-gradient(135deg, #48bb78, #38a169);">üíæ Database</div>
                </div>
            </div>

            <h3>2.2 C·∫•u tr√∫c th∆∞ m·ª•c</h3>
            <div class="code-block">
                src/
                ‚îú‚îÄ‚îÄ controllers/ <span class="comment"># Presentation Layer</span>
                ‚îÇ ‚îú‚îÄ‚îÄ CustomerController.java
                ‚îÇ ‚îî‚îÄ‚îÄ OrderController.java
                ‚îú‚îÄ‚îÄ services/ <span class="comment"># Business Logic Layer</span>
                ‚îÇ ‚îú‚îÄ‚îÄ CustomerService.java
                ‚îÇ ‚îî‚îÄ‚îÄ OrderService.java
                ‚îú‚îÄ‚îÄ repositories/ <span class="comment"># Data Access Layer</span>
                ‚îÇ ‚îú‚îÄ‚îÄ CustomerRepository.java
                ‚îÇ ‚îî‚îÄ‚îÄ OrderRepository.java
                ‚îî‚îÄ‚îÄ models/ <span class="comment"># Entities (shared)</span>
                ‚îú‚îÄ‚îÄ Customer.java
                ‚îî‚îÄ‚îÄ Order.java
            </div>

            <h3>2.3 Flow ho·∫°t ƒë·ªông</h3>
            <div class="diagram-box">
                <div class="flow-diagram">
                    <div class="flow-box" style="background: #4299e1;">User Request</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="background: #5a67d8;">Controller</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="background: #667eea;">Service</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="background: #dd6b20;">Repository</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="background: #38a169;">Database</div>
                </div>
            </div>

            <h3>2.4 Code v√≠ d·ª•</h3>
            <div class="code-block">
                <span class="annotation">@Service</span>
                <span class="keyword">public class</span> <span class="type">CustomerService</span> {

                <span class="comment">// Inject tr·ª±c ti·∫øp implementation</span>
                <span class="annotation">@Autowired</span>
                <span class="keyword">private</span> <span class="type">CustomerRepository</span> customerRepository;

                <span class="comment">// ‚ö†Ô∏è C√≥ th·ªÉ inject repository c·ªßa module kh√°c!</span>
                <span class="annotation">@Autowired</span>
                <span class="keyword">private</span> <span class="type">OrderRepository</span> orderRepository;

                <span class="keyword">public</span> <span class="type">Customer</span> createCustomer(<span
                    class="type">CustomerDto</span> dto) {
                <span class="type">Customer</span> customer = <span class="keyword">new</span> <span
                    class="type">Customer</span>();
                customer.setName(dto.getName()); <span class="comment">// Anemic entity</span>
                customer.setEmail(dto.getEmail());
                <span class="keyword">return</span> customerRepository.save(customer);
                }
                }
            </div>

            <div class="highlight-box red">
                <h4>‚ö†Ô∏è V·∫•n ƒë·ªÅ c·ªßa N-Layer</h4>
                <ul>
                    <li><strong>Coupling cao:</strong> Service ph·ª• thu·ªôc tr·ª±c ti·∫øp v√†o Repository implementation</li>
                    <li><strong>Cross-module access:</strong> CustomerService c√≥ th·ªÉ g·ªçi OrderRepository tr·ª±c ti·∫øp</li>
                    <li><strong>Anemic model:</strong> Entity ch·ªâ c√≥ getter/setter, kh√¥ng c√≥ behavior</li>
                    <li><strong>Kh√≥ test:</strong> C·∫ßn database th·∫≠t ƒë·ªÉ test Service</li>
                </ul>
            </div>
        </section>

        <!-- PH·∫¶N 3: CLEAN ARCHITECTURE -->
        <section class="section">
            <h2 style="color: var(--clean);">üßÖ Ph·∫ßn 3: Clean Architecture</h2>

            <h3>3.1 √ù t∆∞·ªüng ch√≠nh</h3>
            <p><strong>Dependencies ƒëi t·ª´ NGO√ÄI V√ÄO TRONG</strong> - Core business kh√¥ng bi·∫øt v·ªÅ database hay framework.
            </p>

            <div class="highlight-box green">
                <h4>üîë Dependency Rule (Quy t·∫Øc quan tr·ªçng nh·∫•t!)</h4>
                <p>Code ·ªü v√≤ng trong <strong>KH√îNG ƒê∆Ø·ª¢C</strong> bi·∫øt b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ code ·ªü v√≤ng ngo√†i.</p>
                <p>Entity kh√¥ng import Spring. Use Case kh√¥ng import JPA. Ch·ªâ c√≥ Infrastructure m·ªõi bi·∫øt v·ªÅ framework.
                </p>
            </div>

            <h3>3.2 M√¥ h√¨nh v√≤ng tr√≤n (Onion)</h3>
            <div class="diagram-box">
                <div style="text-align: center;">
                    <div
                        style="display: inline-block; padding: 20px; border-radius: 50%; border: 3px solid var(--accent); background: rgba(237,137,54,0.1); width: 320px; height: 320px;">
                        <div
                            style="padding: 15px; border-radius: 50%; border: 3px solid var(--primary); background: rgba(102,126,234,0.1); width: 260px; height: 260px; margin: 0 auto;">
                            <div
                                style="padding: 15px; border-radius: 50%; border: 3px solid #68d391; background: rgba(104,211,145,0.1); width: 200px; height: 200px; margin: 0 auto;">
                                <div
                                    style="padding: 30px; border-radius: 50%; background: linear-gradient(135deg, var(--secondary), #2f855a); width: 140px; height: 140px; margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                                    <strong>Entities</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 1rem; flex-wrap: wrap;">
                    <span style="color: var(--secondary);">üü¢ Entities (Core)</span>
                    <span style="color: #68d391;">üü¢ Use Cases</span>
                    <span style="color: var(--primary);">üîµ Interface Adapters</span>
                    <span style="color: var(--accent);">üü† Frameworks</span>
                </div>
            </div>

            <h3>3.3 Gi·∫£i th√≠ch t·ª´ng layer</h3>
            <table class="comparison-table">
                <tr>
                    <th>Layer</th>
                    <th>Ch·ª©a g√¨?</th>
                    <th>V√≠ d·ª•</th>
                </tr>
                <tr>
                    <td style="color: var(--secondary);"><strong>Entities</strong></td>
                    <td>Domain models, business objects</td>
                    <td>Customer.java, Order.java</td>
                </tr>
                <tr>
                    <td style="color: #68d391;"><strong>Use Cases</strong></td>
                    <td>Application logic, business rules</td>
                    <td>CreateCustomerUseCase, GetOrdersUseCase</td>
                </tr>
                <tr>
                    <td style="color: var(--primary);"><strong>Interface Adapters</strong></td>
                    <td>Controllers, Presenters, Repository impl</td>
                    <td>CustomerController, JpaCustomerRepository</td>
                </tr>
                <tr>
                    <td style="color: var(--accent);"><strong>Frameworks</strong></td>
                    <td>Spring, JPA, Database drivers</td>
                    <td>Spring Boot, Hibernate, MySQL driver</td>
                </tr>
            </table>

            <h3>3.4 C·∫•u tr√∫c th∆∞ m·ª•c</h3>
            <div class="code-block">
                src/
                ‚îú‚îÄ‚îÄ domain/ <span class="comment"># Entities (Core - innermost)</span>
                ‚îÇ ‚îú‚îÄ‚îÄ Customer.java
                ‚îÇ ‚îî‚îÄ‚îÄ Order.java
                ‚îú‚îÄ‚îÄ application/ <span class="comment"># Use Cases</span>
                ‚îÇ ‚îú‚îÄ‚îÄ usecases/
                ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ CreateCustomerUseCase.java
                ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ GetCustomerOrdersUseCase.java
                ‚îÇ ‚îî‚îÄ‚îÄ ports/ <span class="comment"># Interfaces (NOT impl!)</span>
                ‚îÇ ‚îú‚îÄ‚îÄ CustomerRepository.java <span class="comment"># interface only</span>
                ‚îÇ ‚îî‚îÄ‚îÄ OrderRepository.java <span class="comment"># interface only</span>
                ‚îú‚îÄ‚îÄ adapters/ <span class="comment"># Interface Adapters</span>
                ‚îÇ ‚îú‚îÄ‚îÄ in/
                ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ CustomerController.java
                ‚îÇ ‚îî‚îÄ‚îÄ out/
                ‚îÇ ‚îî‚îÄ‚îÄ JpaCustomerRepository.java <span class="comment"># implements port</span>
                ‚îî‚îÄ‚îÄ infrastructure/ <span class="comment"># Frameworks & Drivers</span>
                ‚îî‚îÄ‚îÄ config/
                ‚îî‚îÄ‚îÄ DatabaseConfig.java
            </div>

            <h3>3.5 Code v√≠ d·ª• - Dependency Inversion</h3>
            <div class="code-block">
                <span class="comment">// 1. PORT (Interface) - ƒê·ªãnh nghƒ©a ·ªü APPLICATION layer</span>
                <span class="keyword">public interface</span> <span class="type">CustomerRepository</span> {
                <span class="type">Optional</span>&lt;<span class="type">Customer</span>&gt; findById(<span
                    class="type">String</span> id);
                <span class="type">Customer</span> save(<span class="type">Customer</span> customer);
                }

                <span class="comment">// 2. USE CASE - Ph·ª• thu·ªôc v√†o INTERFACE, kh√¥ng ph·∫£i implementation</span>
                <span class="keyword">public class</span> <span class="type">CreateCustomerUseCase</span> {

                <span class="keyword">private final</span> <span class="type">CustomerRepository</span> repository;
                <span class="comment">// Interface!</span>

                <span class="keyword">public</span> <span class="type">Customer</span> execute(<span
                    class="type">CreateCustomerCommand</span> cmd) {
                <span class="type">Customer</span> customer = <span class="keyword">new</span> <span
                    class="type">Customer</span>(cmd.getName(), cmd.getEmail());
                <span class="keyword">return</span> repository.save(customer);
                }
                }

                <span class="comment">// 3. ADAPTER - Implement interface, ·ªü INFRASTRUCTURE layer</span>
                <span class="annotation">@Repository</span>
                <span class="keyword">public class</span> <span class="type">JpaCustomerRepository</span> <span
                    class="keyword">implements</span> <span class="type">CustomerRepository</span> {

                <span class="annotation">@Autowired</span>
                <span class="keyword">private</span> <span class="type">SpringDataCustomerRepo</span> jpaRepo;

                <span class="annotation">@Override</span>
                <span class="keyword">public</span> <span class="type">Customer</span> save(<span
                    class="type">Customer</span> customer) {
                <span class="type">CustomerEntity</span> entity = toEntity(customer);
                <span class="type">CustomerEntity</span> saved = jpaRepo.save(entity);
                <span class="keyword">return</span> toDomain(saved);
                }
                }
            </div>

            <div class="highlight-box green">
                <h4>‚úÖ L·ª£i √≠ch c·ªßa Clean Architecture</h4>
                <ul>
                    <li><strong>D·ªÖ test:</strong> Mock interface CustomerRepository d·ªÖ d√†ng</li>
                    <li><strong>D·ªÖ ƒë·ªïi DB:</strong> Ch·ªâ c·∫ßn t·∫°o MongoCustomerRepository implements CustomerRepository
                    </li>
                    <li><strong>Core ƒë·ªôc l·∫≠p:</strong> Domain v√† Use Cases kh√¥ng bi·∫øt v·ªÅ Spring, JPA</li>
                </ul>
            </div>
        </section>

        <!-- PH·∫¶N 4: DDD -->
        <section class="section">
            <h2 style="color: var(--ddd);">üéØ Ph·∫ßn 4: Domain-Driven Design (DDD)</h2>

            <h3>4.1 √ù t∆∞·ªüng ch√≠nh</h3>
            <p><strong>Chia theo NGHI·ªÜP V·ª§ (Domain)</strong> - Kh√¥ng ph·∫£i theo k·ªπ thu·∫≠t. M·ªói "nghi·ªáp v·ª•" l√† m·ªôt Bounded
                Context ƒë·ªôc l·∫≠p.</p>

            <div class="highlight-box blue">
                <h4>üîë Bounded Context = Module nghi·ªáp v·ª• ƒë·ªôc l·∫≠p</h4>
                <p>Customer Context, Order Context, Card Context - m·ªói context c√≥:</p>
                <ul>
                    <li>Database ri√™ng (l√Ω t∆∞·ªüng)</li>
                    <li>Domain model ri√™ng</li>
                    <li>Repository ri√™ng (private)</li>
                    <li>Giao ti·∫øp v·ªõi context kh√°c qua <strong>public interface</strong></li>
                </ul>
            </div>

            <h3>4.2 C√°c kh√°i ni·ªám DDD</h3>
            <table class="comparison-table">
                <tr>
                    <th>Kh√°i ni·ªám</th>
                    <th>Gi·∫£i th√≠ch</th>
                    <th>V√≠ d·ª•</th>
                </tr>
                <tr>
                    <td><strong>Bounded Context</strong></td>
                    <td>Ranh gi·ªõi nghi·ªáp v·ª• ƒë·ªôc l·∫≠p</td>
                    <td>Customer BC, Order BC, Payment BC</td>
                </tr>
                <tr>
                    <td><strong>Aggregate</strong></td>
                    <td>Nh√≥m entities li√™n quan, c√≥ 1 Root</td>
                    <td>Order (root) + OrderItems</td>
                </tr>
                <tr>
                    <td><strong>Entity</strong></td>
                    <td>Object c√≥ ID duy nh·∫•t</td>
                    <td>Customer(id), Order(id)</td>
                </tr>
                <tr>
                    <td><strong>Value Object</strong></td>
                    <td>Object kh√¥ng c√≥ ID, so s√°nh b·∫±ng value</td>
                    <td>Money, Email, Address</td>
                </tr>
                <tr>
                    <td><strong>Domain Event</strong></td>
                    <td>S·ª± ki·ªán nghi·ªáp v·ª• ƒë√£ x·∫£y ra</td>
                    <td>OrderCreated, CustomerSuspended</td>
                </tr>
                <tr>
                    <td><strong>Domain Service</strong></td>
                    <td>Logic span nhi·ªÅu entities</td>
                    <td>TransferMoneyService</td>
                </tr>
            </table>

            <h3>4.3 C·∫•u tr√∫c Bounded Context</h3>
            <div class="code-block">
                customer/ <span class="comment"># BOUNDED CONTEXT: Customer</span>
                ‚îú‚îÄ‚îÄ domain/ <span class="comment"># Domain Layer (CORE)</span>
                ‚îÇ ‚îú‚îÄ‚îÄ model/
                ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Customer.java <span class="comment"># Aggregate Root</span>
                ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ CustomerId.java <span class="comment"># Value Object</span>
                ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ Email.java <span class="comment"># Value Object</span>
                ‚îÇ ‚îú‚îÄ‚îÄ event/
                ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ CustomerCreatedEvent.java
                ‚îÇ ‚îú‚îÄ‚îÄ repository/
                ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ CustomerRepository.java <span class="comment"># Interface ONLY</span>
                ‚îÇ ‚îî‚îÄ‚îÄ service/
                ‚îÇ ‚îî‚îÄ‚îÄ CustomerDomainService.java
                ‚îú‚îÄ‚îÄ application/ <span class="comment"># Application Layer</span>
                ‚îÇ ‚îú‚îÄ‚îÄ CustomerApplicationService.java
                ‚îÇ ‚îî‚îÄ‚îÄ port/
                ‚îÇ ‚îî‚îÄ‚îÄ CardServicePort.java <span class="comment"># G·ªçi Card context</span>
                ‚îî‚îÄ‚îÄ infrastructure/ <span class="comment"># Infrastructure Layer</span>
                ‚îú‚îÄ‚îÄ JpaCustomerRepository.java
                ‚îî‚îÄ‚îÄ CardServiceAdapter.java
            </div>

            <h3>4.4 Giao ti·∫øp gi·ªØa Bounded Contexts</h3>
            <p><strong>‚ö†Ô∏è QUAN TR·ªåNG:</strong> Context A KH√îNG ƒë∆∞·ª£c g·ªçi tr·ª±c ti·∫øp Repository c·ªßa Context B!</p>

            <div class="diagram-box">
                <div class="flow-diagram">
                    <div class="flow-box" style="background: var(--ddd); min-width: 150px;">
                        <strong>Customer Context</strong><br>
                        <small>CustomerAppService</small>
                    </div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="background: var(--accent); min-width: 120px;">
                        <strong>Port</strong><br>
                        <small>CardServicePort</small>
                    </div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="background: var(--secondary); min-width: 150px;">
                        <strong>Card Context</strong><br>
                        <small>CardAppService</small>
                    </div>
                </div>
            </div>

            <h3>4.5 Code v√≠ d·ª• - Cross-Context Communication</h3>
            <div class="code-block">
                <span class="comment">// ‚ùå SAI - G·ªçi tr·ª±c ti·∫øp CardRepository</span>
                <span class="keyword">public class</span> <span class="type">CustomerService</span> {
                <span class="keyword">private</span> <span class="type">CardRepository</span> cardRepo; <span
                    class="comment">// KH√îNG ƒê∆Ø·ª¢C!</span>
                }

                <span class="comment">// ‚úÖ ƒê√öNG - G·ªçi qua Port ‚Üí CardApplicationService</span>
                <span class="keyword">public class</span> <span class="type">CustomerApplicationService</span> {

                <span class="keyword">private final</span> <span class="type">CustomerRepository</span> customerRepo;
                <span class="keyword">private final</span> <span class="type">CardServicePort</span> cardServicePort;
                <span class="comment">// Interface!</span>

                <span class="keyword">public</span> <span class="type">CustomerWithCards</span>
                getCustomerWithCards(<span class="type">String</span> customerId) {
                <span class="type">Customer</span> customer = customerRepo.findById(customerId);

                <span class="comment">// G·ªçi Card context qua PORT</span>
                <span class="type">List</span>&lt;<span class="type">CardDto</span>&gt; cards =
                cardServicePort.getCardsByCustomerId(customerId);

                <span class="keyword">return new</span> <span class="type">CustomerWithCards</span>(customer, cards);
                }
                }

                <span class="comment">// Port interface (trong Customer context)</span>
                <span class="keyword">public interface</span> <span class="type">CardServicePort</span> {
                <span class="type">List</span>&lt;<span class="type">CardDto</span>&gt; getCardsByCustomerId(<span
                    class="type">String</span> customerId);
                }

                <span class="comment">// Adapter (implement Port, g·ªçi Card's public service)</span>
                <span class="keyword">public class</span> <span class="type">CardServiceAdapter</span> <span
                    class="keyword">implements</span> <span class="type">CardServicePort</span> {

                <span class="keyword">private final</span> <span class="type">CardApplicationService</span> cardService;
                <span class="comment">// From Card context</span>

                <span class="annotation">@Override</span>
                <span class="keyword">public</span> <span class="type">List</span>&lt;<span
                    class="type">CardDto</span>&gt; getCardsByCustomerId(<span class="type">String</span> id) {
                <span class="keyword">return</span> cardService.findCardsByCustomer(id); <span class="comment">// Public
                    method</span>
                }
                }
            </div>

            <h3>4.6 Rich Domain Model</h3>
            <div class="code-block">
                <span class="comment">// Rich Entity - C√≥ behavior, kh√¥ng ch·ªâ getter/setter</span>
                <span class="keyword">public class</span> <span class="type">Customer</span> {

                <span class="keyword">private</span> <span class="type">CustomerId</span> id;
                <span class="keyword">private</span> <span class="type">Email</span> email;
                <span class="keyword">private</span> <span class="type">CustomerStatus</span> status;
                <span class="keyword">private</span> <span class="type">List</span>&lt;<span
                    class="type">DomainEvent</span>&gt; events = <span class="keyword">new</span> ArrayList&lt;&gt;();

                <span class="comment">// Factory method</span>
                <span class="keyword">public static</span> <span class="type">Customer</span> create(<span
                    class="type">String</span> name, <span class="type">Email</span> email) {
                <span class="type">Customer</span> c = <span class="keyword">new</span> <span
                    class="type">Customer</span>(<span class="type">CustomerId</span>.generate(), name, email);
                c.addEvent(<span class="keyword">new</span> <span class="type">CustomerCreatedEvent</span>(c.id));
                <span class="keyword">return</span> c;
                }

                <span class="comment">// Business behavior - KH√îNG d√πng setter!</span>
                <span class="keyword">public void</span> suspend(<span class="type">String</span> reason) {
                <span class="keyword">if</span> (<span class="keyword">this</span>.status == SUSPENDED) {
                <span class="keyword">throw new</span> <span class="type">BusinessException</span>(<span
                    class="string">"Already suspended"</span>);
                }
                <span class="keyword">this</span>.status = SUSPENDED;
                <span class="keyword">this</span>.addEvent(<span class="keyword">new</span> <span
                    class="type">CustomerSuspendedEvent</span>(<span class="keyword">this</span>.id, reason));
                }
                }
            </div>
        </section>

        <!-- PH·∫¶N 5: SO S√ÅNH -->
        <section class="section">
            <h2>üìä Ph·∫ßn 5: So s√°nh T·ªïng k·∫øt</h2>

            <table class="comparison-table">
                <tr>
                    <th>Ti√™u ch√≠</th>
                    <th style="color: var(--nlayer);">N-Layer</th>
                    <th style="color: var(--clean);">Clean</th>
                    <th style="color: var(--ddd);">DDD</th>
                </tr>
                <tr>
                    <td>Chia theo</td>
                    <td>K·ªπ thu·∫≠t</td>
                    <td>V√≤ng tr√≤n</td>
                    <td>Nghi·ªáp v·ª•</td>
                </tr>
                <tr>
                    <td>Dependency</td>
                    <td>Top ‚Üí Down</td>
                    <td>Outside ‚Üí Inside</td>
                    <td>‚Üí Domain ‚Üê</td>
                </tr>
                <tr>
                    <td>Cross-module</td>
                    <td>G·ªçi tr·ª±c ti·∫øp Repo</td>
                    <td>Qua Use Case</td>
                    <td>Qua App Service</td>
                </tr>
                <tr>
                    <td>Entity style</td>
                    <td>Anemic</td>
                    <td>C√≥ th·ªÉ Rich</td>
                    <td>Rich (b·∫Øt bu·ªôc)</td>
                </tr>
                <tr>
                    <td>Test effort</td>
                    <td>Kh√≥</td>
                    <td>D·ªÖ</td>
                    <td>R·∫•t d·ªÖ</td>
                </tr>
                <tr>
                    <td>Ph√π h·ª£p</td>
                    <td>CRUD ƒë∆°n gi·∫£n</td>
                    <td>Medium apps</td>
                    <td>Complex domain</td>
                </tr>
            </table>

            <h3>Khi n√†o d√πng?</h3>
            <div class="grid-2">
                <div class="card red">
                    <h4 style="color: var(--nlayer);">üì¶ D√πng N-Layer khi</h4>
                    <ul>
                        <li>App nh·ªè, CRUD ƒë∆°n gi·∫£n</li>
                        <li>Deadline g·∫•p, c·∫ßn MVP</li>
                        <li>Team junior</li>
                        <li>Kh√¥ng c·∫ßn test nhi·ªÅu</li>
                    </ul>
                </div>
                <div class="card green">
                    <h4 style="color: var(--clean);">üßÖ D√πng Clean khi</h4>
                    <ul>
                        <li>C·∫ßn testability cao</li>
                        <li>C√≥ th·ªÉ thay ƒë·ªïi framework</li>
                        <li>Medium complexity</li>
                        <li>Team c√≥ kinh nghi·ªám</li>
                    </ul>
                </div>
                <div class="card blue">
                    <h4 style="color: var(--ddd);">üéØ D√πng DDD khi</h4>
                    <ul>
                        <li>Domain ph·ª©c t·∫°p</li>
                        <li>Nhi·ªÅu business rules</li>
                        <li>Microservices</li>
                        <li>Long-term project</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="footer">
            <p>üìö Software Architecture Guide | Tailor Shop Docs</p>
            <p>Created by Antigravity AI ‚Ä¢ 2026</p>
        </footer>

    </div>
</body>

</html>